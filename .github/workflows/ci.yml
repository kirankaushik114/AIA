      - name: Fail job on test failures
        if: always()
        run: |
          if [ -f reports/output.xml ]; then
            FAILS=$(grep -o '<failures>[0-9]\+' reports/output.xml | head -n1 | sed -E 's/[^0-9]//g')
            if [ -z "$FAILS" ]; then
              echo "⚠️ Could not determine failure count — treating as success."
              FAILS=0
            fi
            if [ "$FAILS" -gt 0 ]; then
              echo "❌ Tests failed: $FAILS"
              exit 1
            else
              echo "✅ All tests passed successfully."
            fi
          else
            echo "⚠️ No output.xml found — treating as failure."
            exit 1
          fi
